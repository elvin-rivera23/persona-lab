# =========================
# Persona Lab â€” Environment
# =========================

# API
APP_HOST=0.0.0.0
APP_PORT=8001

# Service Metadata
SERVICE_NAME=persona-lab
SERVICE_VERSION=0.1.0

# Engagement DB (SQLite file path)
# Will be volume-mounted by Docker Compose to persist data
DB_PATH=/data/engagement.db

# --- Feedback / Leaderboard ---
FEEDBACK_DB_PATH=./data/feedback.db

# --- Safety Controls ---
SAFETY_KILL_SWITCH=0
SAFETY_MAX_PROMPT_CHARS=4000
# Comma-separated words to block (case-insensitive)
SAFETY_DENYLIST=
SAFETY_DEFAULT_LATENCY_BUDGET_MS=3500

# ---- Inference Efficiency ----
# Request timeout (seconds) for a single upstream LLM call
LLM_TIMEOUT_SECS=8

# Retry policy
LLM_RETRY_MAX_ATTEMPTS=2            # total tries = 1 initial + 2 retries
LLM_RETRY_BACKOFF_BASE_MS=200       # 200ms, then 400ms (exponential)

# Circuit breaker window
LLM_CB_WINDOW_SECONDS=30            # rolling window size
LLM_CB_FAILURE_THRESHOLD=0.5        # open if >=50% of recent calls fail
LLM_CB_MIN_CALLS=6                  # need at least 6 calls in window to evaluate
LLM_CB_HALFOPEN_AFTER_SECONDS=15    # how long to wait before probing again

# Optional latency budget (ms): if exceeded, we will allow fallback in 9B
LLM_LATENCY_BUDGET_MS=2500
